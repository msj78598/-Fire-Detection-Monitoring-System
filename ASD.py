import os
import streamlit as st
import torch
import urllib.request
import pathlib
from ultralytics import YOLO

# âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØªØ­Ø¯ÙŠØ«Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
MODEL_PATH = "best.pt"
MODEL_URL = "https://raw.githubusercontent.com/msj78598/Fire-Detection-Monitoring-System/main/best.pt"

# ğŸ”¹ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ ÙˆØµØ§Ù„Ø­
if not os.path.exists(MODEL_PATH) or os.path.getsize(MODEL_PATH) < 10000:
    st.warning("ğŸ“¥ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±!")
    urllib.request.urlretrieve(MODEL_URL, MODEL_PATH)
    st.success("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!")

try:
    # ğŸ”¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ø¥Ù„Ù‰ Ù†Øµ (ØªØ¬Ù†Ø¨ WindowsPath)
    model = YOLO(str(MODEL_PATH))  # âœ… ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø± ÙƒÙ†Øµ Ø¹Ø§Ø¯ÙŠ
    st.session_state.model = model
    st.success("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ YOLOv5 Ø¨Ù†Ø¬Ø§Ø­!")
except Exception as e:
    st.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ YOLOv5: {e}")
    st.stop()  # ğŸ”´ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­
